--- nslu2-linksys-ramdisk-2.3r25/etc/rc~	2004-07-27 23:37:55.000000000 -0400
+++ nslu2-linksys-ramdisk-2.3r25/etc/rc	2004-09-01 21:47:47.000000000 -0400
@@ -1,4 +1,26 @@
 ## Simple beta script to verify csr
+
+if ( [ -f /unslung/rc ] && . /unslung/rc ) ; then return 0 ; fi
+
 /usr/bin/Set_Led r_blinking &
 mount -t proc proc /proc
 mount -o remount,rw /dev/root /
+
+if [ -f /.ramdisk ] ; then
+   echo "Root filesystem is running in maintenance mode ..."
+   ( cd /home/httpd/html/Management ; mv upgrade-maint.htm upgrade.htm )
+fi
+
+#if ( [ -f /.sda2root ] || [ -f /.sdb2root ] ) ; then
+#   echo "Root filesystem is running a external disk ..."
+#   ( cd /home/httpd/html/Management ; mv upgrade-maint.htm upgrade.htm )
+#fi
+
+# Wait for the USB disks to be recognised.
+sleep 5
+
+if ( [ -f /proc/hd_conn ] ) ; then
+  /bin/mount -t ext3 /dev/sda2 /share/hdd/conf
+  /bin/rm -rf /mnt/sda2 ; /bin/ln -s /share/hdd/conf /mnt/sda2
+fi
+
+if ( [ -f /proc/hd2_conn ] ) ; then
+  /bin/mount -t ext3 /dev/sdb2 /share/flash/conf
+  /bin/rm -rf /mnt/sdb2 ; /bin/ln -s /share/flash/conf /mnt/sdb2
+fi
+
