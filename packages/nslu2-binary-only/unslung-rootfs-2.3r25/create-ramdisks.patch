--- nslu2-linksys-ramdisk-2.3r25/etc/rc.d/rc.sysinit.orig	2004-11-09 21:45:46.000000000 +1030
+++ nslu2-linksys-ramdisk-2.3r25/etc/rc.d/rc.sysinit	2004-11-09 21:41:47.000000000 +1030
@@ -13,7 +13,23 @@
 
 mkdir -p /var/lock/samba >/dev/null
-/bin/echo  "Creating ramfs for /var/lock/samba:"; mount -t ramfs none /var/lock/samba -o maxsize=64
-/bin/echo  "Limit the space of log folder:"; mount -t ramfs none /var/log -o maxsize=128
+
+/bin/echo "Creating ramfs for /dev:"
+/bin/mount -t ramfs ramfs /mnt/tmpmnt
+/bin/cp -r /dev/* /mnt/tmpmnt/
+/bin/mkdir -p /dev.state
+/bin/mount -o bind /dev /dev.state
+/bin/mount -o bind /mnt/tmpmnt /dev
+/bin/umount /mnt/tmpmnt
+/bin/echo "Creating ramfs for /var:"
+/bin/mount -t ramfs ramfs /mnt/tmpmnt -o maxsize=256
+/bin/cp -r /var/* /mnt/tmpmnt/
+/bin/mkdir -p /var.state
+/bin/mount -o bind /var /var.state
+/bin/mount -o bind /mnt/tmpmnt /var
+/bin/umount /mnt/tmpmnt
+/bin/killall syslogd
+/bin/killall klogd
+
 mkdir -p /var/log/samba >/dev/null
 touch /var/log/server.log >/dev/null
 chmod 755 /var/log/samba >/dev/null
