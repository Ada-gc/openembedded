#!/bin/sh

echo "Firmware Version: `cat /.unslung`"

mounted=

/bin/mount -t proc proc /proc
echo "0x0100" > /proc/sys/kernel/real-root-dev

/bin/sleep 10

if [ -z "$mounted" ] && /bin/mount -rt ext3 /dev/sda2 /mnt/tmpmnt ; then

    if  [ -x /mnt/tmpmnt/bin/init ] &&
	[ -d /mnt/tmpmnt/unslung ] && [ -r /mnt/tmpmnt/.unslung ] &&
	[ "`cat /.unslung`" = "`cat /mnt/tmpmnt/.unslung`" ] ; then
	echo "Root filesystem will be mounted from /dev/sda2 ..."
	mounted=/mnt/tmpmnt
	echo "0x0802" > /proc/sys/kernel/real-root-dev
	[ -r $mounted/unslung/rc.linuxrc ] && . $mounted/unslung/rc.linuxrc
    fi

    /bin/umount /mnt/tmpmnt
fi

if [ -z "$mounted" ] && /bin/mount -rt ext3 /dev/sdb2 /mnt/tmpmnt ; then

    if  [ -x /mnt/tmpmnt/bin/init ] &&
	[ -d /mnt/tmpmnt/unslung ] && [ -r /mnt/tmpmnt/.unslung ] &&
	[ "`cat /.unslung`" = "`cat /mnt/tmpmnt/.unslung`" ] ; then
	echo "Root filesystem will be mounted from /dev/sdb2 ..."
	mounted=/mnt/tmpmnt
	echo "0x0812" > /proc/sys/kernel/real-root-dev
	[ -r $mounted/unslung/rc.linuxrc ] && . $mounted/unslung/rc.linuxrc
    fi

    /bin/umount /mnt/tmpmnt
fi

if [ -z "$mounted" ] ; then
    echo "Root filesystem will be mounted from /dev/ram0 ..."
fi

/bin/umount /proc

exit 0
