#@TYPE: Distribution
#@NAME: OpenZaurus
#@DESCRIPTION: Distribution configuration for OpenZaurus (http://www.openzaurus.org)

INHERIT += " package_ipk debian"
# For some reason, this doesn't work
# TARGET_OS ?= "linux"
TARGET_OS = "linux"
TARGET_FPU = "soft"

BOOTSTRAP_EXTRA_DEPENDS  += "openzaurus-version"
BOOTSTRAP_EXTRA_RDEPENDS += "openzaurus-version"
IMAGE_NAME = "${IMAGE_BASENAME}-${DISTRO_VERSION}-${MACHINE}"

PARALLEL_INSTALL_MODULES = "1"

DISTRO_CHECK := "${@bb.data.getVar("DISTRO_VERSION",d,1) or bb.fatal('You are trying to build unsupported OpenZaurus version.')}"

# Ethernet modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-pcnet-cs"

# NFS Modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-nfs kernel-module-lockd kernel-module-sunrpc"

# Crypto Modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-des kernel-module-md5"

# SMB and CRAMFS
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-smbfs kernel-module-cramfs"

# Serial Modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-8250 kernel-module-serial-cs"

# Bluetooth Modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-bluetooth kernel-module-l2cap kernel-module-rfcomm kernel-module-hci-vhci \
                             kernel-module-bnep kernel-module-hidp kernel-module-hci-uart kernel-module-sco \
                             kernel-module-bt3c-cs kernel-module-bluecard-cs kernel-module-btuart-cs kernel-module-dtl1-cs"

# Infrared Modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-pxaficp-ir kernel-module-irda kernel-module-ircomm \
                             kernel-module-ircomm-tty kernel-module-irlan kernel-module-irnet"

# USB Gadget Modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-gadgetfs kernel-module-g-file-storage \
                             kernel-module-g-serial kernel-module-g-ether"

# Wireless Modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-hostap kernel-module-hostap-cs \
                             kernel-module-hermes kernel-module-orinoco \
                             kernel-module-orinoco-cs kernel-module-spectrum-cs \
                             kernel-module-ieee80211-crypt kernel-module-ieee80211-crypt-ccmp \
                             kernel-module-ieee80211-crypt-tkip kernel-module-ieee80211-crypt-wep \
                             kernel-module-arc4 kernel-module-michael-mic kernel-module-aes"

# Sound Modules
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-snd-mixer-oss kernel-module-snd-pcm-oss"
BOOTSTRAP_EXTRA_RRECOMMENDS += "kernel-module-soundcore kernel-module-snd kernel-module-snd-page-alloc \
                             kernel-module-snd-timer kernel-module-snd-pcm  \
                             kernel-module-snd-soc-core kernel-module-snd-soc-pxa2xx \
                             kernel-module-snd-soc-pxa2xx-i2s"

# USB Host modules

USBHOST_MODULES = "kernel-module-ohci-hcd kernel-module-usbcore kernel-module-usbhid \
                   kernel-module-usbnet kernel-module-sd-mod kernel-module-scsi-mod \
                   kernel-module-usbmouse kernel-module-mousedev kernel-module-hci-usb \
                   kernel-module-usbserial kernel-module-usb-storage kernel-module-ir-usb"

BOOTSTRAP_EXTRA_RRECOMMENDS_append_spitz += " ${USBHOST_MODULES} "
BOOTSTRAP_EXTRA_RRECOMMENDS_append_akita += " ${USBHOST_MODULES} "
BOOTSTRAP_EXTRA_RRECOMMENDS_append_tosa  += " ${USBHOST_MODULES} "

# add WiFi card config for ALL machines

BOOTSTRAP_EXTRA_RDEPENDS += "hostap-conf orinoco-conf oz-bootsplash"
BOOTSTRAP_EXTRA_RDEPENDS_append_akita = " usbutils "
BOOTSTRAP_EXTRA_RDEPENDS_append_spitz = " usbutils "
BOOTSTRAP_EXTRA_RDEPENDS_append_tosa  = " usbutils "

BOOTSTRAP_EXTRA_DEPENDS += "hostap-conf orinoco-conf oz-bootsplash"
BOOTSTRAP_EXTRA_DEPENDS_append_akita = " usbutils "
BOOTSTRAP_EXTRA_DEPENDS_append_spitz = " usbutils "
BOOTSTRAP_EXTRA_DEPENDS_append_tosa  = " usbutils "

BB_MIN_VERSION = "1.4.4"
INHERIT += "sanity"

CVS_TARBALL_STASH = "\
http://ewi546.ewi.utwente.nl/mirror/www.openzaurus.org/official/unstable/3.5.4/sources/ \
http://www.oesources.org/source/current/"

