#@TYPE: Machine
#@NAME: Dreambox DM7025
#@DESCRIPTION: Machine configuration for the Dreambox DM7025

TARGET_ARCH = "mipsel"
IPKG_ARCHS = "all mipsel ${MACHINE}"
PREFERRED_PROVIDER_xserver = "xserver-kdrive"
PREFERRED_PROVIDER_virtual/kernel = "linux-dm7025"
BOOTSTRAP_EXTRA_DEPENDS = "virtual/kernel dreambox-dvb-modules"
BOOTSTRAP_EXTRA_RDEPENDS = "kernel dreambox-dvb-modules kernel-module-stv0299 \
	kernel-module-cdrom	kernel-module-cifs	kernel-module-exportfs \
	kernel-module-ide-cd	kernel-module-isofs	kernel-module-ohci-hcd \
	kernel-module-reiserfs 	kernel-module-scsi-mod	kernel-module-sd-mod \
	kernel-module-sg	kernel-module-sr-mod	kernel-module-usb-storage \
	kernel-module-usbcore	kernel-module-usbhid	kernel-module-usbmon \
	kernel-module-xfs"

TARGET_FPU = "soft"
OLDEST_KERNEL = "2.6.9"

PREFERRED_PROVIDERS += " virtual/${TARGET_PREFIX}gcc-initial:gcc-cross-initial"
PREFERRED_PROVIDERS += " virtual/${TARGET_PREFIX}gcc:gcc-cross"
PREFERRED_PROVIDERS += " virtual/${TARGET_PREFIX}g++:gcc-cross"
PREFERRED_PROVIDERS += " virtual/${TARGET_PREFIX}libc-for-gcc:glibc"

#PREFERRED_VERSION_glibc = "2.3.5+cvs20050627"
#PREFERRED_VERSION_gcc-cross-initial = "3.4.5"
#PREFERRED_VERSION_gcc-cross = "3.4.5"
#PREFERRED_VERSION_gcc-cross-sdk = "3.4.5"
#PREFERRED_VERSION_gcc = "3.4.5"
#PREFERRED_VERSION_binutils-cross = "2.15.94.0.1"
#PREFERRED_VERSION_binutils-cross-sdk = "2.15.94.0.1"
#PREFERRED_VERSION_binutils = "2.15.94.0.1"
#PREFERRED_VERSION_linux-libc-headers = "2.6.11.1"

PREFERRED_VERSION_glibc = "2.3.5+cvs20051107"
PREFERRED_VERSION_gcc-cross-initial = "3.4.5"
PREFERRED_VERSION_gcc-cross = "4.1.0"
PREFERRED_VERSION_gcc-cross-sdk = "4.1.0" 
PREFERRED_VERSION_gcc = "4.1.0"
PREFERRED_VERSION_binutils-cross = "2.16.1"
PREFERRED_VERSION_binutils-cross-sdk = "2.16.1"
PREFERRED_VERSION_binutils = "2.16.1"
PREFERRED_VERSION_linux-libc-headers = "2.6.12.0"
GLIBC_ADDONS = "nptl"
GLIBC_EXTRA_OECONF = "--disable-profile --with-tls --without-fp --with-__thread"

EXTRA_IMAGEDEPENDS += "dreambox-secondstage dreambox-buildimage-native"
EXTRA_IMAGECMD_jffs2 = " --eraseblock=0x4000 -n -l "
IMAGE_CMD_jffs2 = "mkfs.jffs2 --root=${IMAGE_ROOTFS}/boot --faketime \
       --output=${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.boot.jffs2 \
       ${EXTRA_IMAGECMD}; rm -rf ${IMAGE_ROOTFS}/boot/*; \
				mkfs.jffs2 --root=${IMAGE_ROOTFS} --faketime \
       --output=${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.jffs2 \
       ${EXTRA_IMAGECMD}; \
       buildimage ${STAGING_LIBDIR}/dreambox-secondstage/main.bin.gz \
       ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.boot.jffs2 \
       ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.jffs2 \
       ${MACHINE} \
       > ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.nfi"
