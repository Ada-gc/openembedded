#@TYPE: Machine
#@Name: Compulab PXA270 system
#@DESCRIPTION: Machine configuration for Compulab PXA270 system
#OLDEST_KERNEL = "2.6.16"
TARGET_ARCH = "arm"
PREFERRED_VERSION_compulab-pxa270 = "2.6.22"
GUI_MACHINE_CLASS ?= "bigscreen"

PREFERRED_PROVIDER_virtual/kernel = "${MACHINE}"
PACKAGE_EXTRA_ARCHS = "armv4 armv5te"

require conf/machine/include/tune-xscale.inc

# used by sysvinit_2 package, so rebuild this
# package if you change the SERIAL_CONSOLE setting
# the following is the for the cm-x270 L module
# I think the W module would use ttyS0, but has
# not been tested.  This can be overwritten in 
# local.conf
SERIAL_CONSOLE ?= "38400 ttyS1"

# used by opie-collections.inc
ROOT_FLASH_SIZE ?= "32"

# for NAND flash.
EXTRA_IMAGECMD_jffs2 = "--little-endian --eraseblock=0x20000 --pad=0x20000 --no-cleanmarkers;\
	sumtool -i ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.jffs2 \
	-o ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs-summary.jffs2 \
	-e 0x20000 -p; \
	cd ${DEPLOY_DIR_IMAGE}; \
	rm -f ${DEPLOY_DIR_IMAGE}/${IMAGE_LINK_NAME}.rootfs-summary.jffs2; \
	ln -s ${IMAGE_NAME}.rootfs-summary.jffs2 ${IMAGE_LINK_NAME}.rootfs-summary.jffs2 \
	"

MACHINE_FEATURES = "kernel26 pcmcia usbhost usbgadget pcmcia touchscreen alsa"

# to program the compulab NAND flash, the following scheme is suggested.  Create
# a small rootfs that can fit in NOR flash using the following config:
#   - Angstrom distro
#   - uclibc
#   - angstrom-minimal-image-with-mtd-utils bitbake target
#   - put the following in your local.conf
#     - IMAGE_FSTYPES = "jffs2 tar cpio.gz"
# now, when you build the image, a cpio.gz will be generated
# that can be used as an initramfs.  You can boot into this image and then
# program the main rootfs jffs2 image in NAND flash using mtd-utils


